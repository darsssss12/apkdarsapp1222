<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Love Video Call ‚ù§Ô∏è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

  <style>
    body {
      margin:0;
      padding:0;
      background:#0b141a;
      font-family: Arial, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    .phone {
      width:100%;
      max-width:420px;
      height:100vh;
      background:black;
      position:relative;
      overflow:hidden;
    }

    .header {
      height:60px;
      background:#202c33;
      color:white;
      display:flex;
      align-items:center;
      padding:0 12px;
      gap:10px;
    }

    .avatar {
      width:36px;
      height:36px;
      border-radius:50%;
      background:#25d366;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:bold;
      color:white;
    }

    .name {
      flex:1;
    }

    .video-area {
      position:relative;
      width:100%;
      height:calc(100% - 120px);
      background:black;
    }

    video {
      width:100%;
      height:100%;
      object-fit:cover;
      background:black;
    }

    #localVideo {
      position:absolute;
      width:120px;
      height:160px;
      bottom:10px;
      right:10px;
      border-radius:12px;
      border:2px solid white;
      object-fit:cover;
      background:black;
    }

    .controls {
      height:60px;
      background:#202c33;
      display:flex;
      align-items:center;
      justify-content:space-around;
    }

    .btn {
      width:44px;
      height:44px;
      border-radius:50%;
      border:none;
      font-size:18px;
      cursor:pointer;
    }

    .btn-red { background:#ff3b30; color:white; }
    .btn-green { background:#25d366; color:white; }
    .btn-dark { background:#3b4a54; color:white; }

    .connect-box {
      position:absolute;
      top:70px;
      left:50%;
      transform:translateX(-50%);
      background:white;
      padding:10px;
      border-radius:12px;
      width:90%;
      text-align:center;
    }

    input {
      padding:8px 10px;
      border-radius:10px;
      border:1px solid #ccc;
      width:80%;
      margin-bottom:6px;
    }

    .hidden { display:none; }
  </style>
</head>
<body>

<div class="phone">

  <!-- HEADER -->
  <div class="header">
    <div class="avatar">‚ù§Ô∏è</div>
    <div class="name" id="callName">Pasangan</div>
  </div>

  <!-- VIDEO AREA -->
  <div class="video-area">
    <video id="remoteVideo" autoplay playsinline></video>
    <video id="localVideo" autoplay playsinline muted></video>

    <!-- CONNECT BOX -->
    <div class="connect-box" id="connectBox">
      <b>Love Video Call üíï</b><br><br>
      <input id="roomIdInput" placeholder="Kode pasangan..."><br>
      <button id="connectBtn" class="btn btn-green">üìû</button>
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="controls">
    <button id="muteBtn" class="btn btn-dark">üéôÔ∏è</button>
    <button id="endBtn" class="btn btn-red">‚ùå</button>
  </div>

</div>

<script>
/* =========================
   SIMPLE ID
========================= */
function generateSimpleID() {
  const name = prompt("Masukkan nama kamu (contoh: asip, ayang)");
  const random = Math.floor(100 + Math.random() * 900);
  return name + random;
}

const myID = generateSimpleID();
const peer = new Peer(myID);

alert("Kode Cinta kamu: " + myID + " ‚ù§Ô∏è\nKirim ke pasangan kamu ya!");

/* =========================
   ELEMENTS
========================= */
const connectBtn = document.getElementById('connectBtn');
const roomIdInput = document.getElementById('roomIdInput');
const remoteVideo = document.getElementById('remoteVideo');
const localVideo = document.getElementById('localVideo');
const connectBox = document.getElementById('connectBox');
const muteBtn = document.getElementById('muteBtn');
const endBtn = document.getElementById('endBtn');

let localStream;
let currentCall;
let isMuted = false;

/* =========================
   GET MEDIA (VIDEO + AUDIO)
========================= */
async function getMedia() {
  localStream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user" },
    audio: true
  });
  localVideo.srcObject = localStream;
}

/* =========================
   PEER EVENTS
========================= */
peer.on('call', async call => {
  await getMedia();
  call.answer(localStream);

  call.on('stream', remoteStream => {
    remoteVideo.srcObject = remoteStream;
    connectBox.classList.add('hidden');
  });

  currentCall = call;
});

/* =========================
   CONNECT BUTTON
========================= */
connectBtn.onclick = async () => {
  const remoteId = roomIdInput.value.trim();
  if (!remoteId) return alert("Masukkan kode pasangan kamu üòò");

  await getMedia();

  currentCall = peer.call(remoteId, localStream);
  currentCall.on('stream', remoteStream => {
    remoteVideo.srcObject = remoteStream;
    connectBox.classList.add('hidden');
  });
};

/* =========================
   MUTE / UNMUTE
========================= */
muteBtn.onclick = () => {
  if (!localStream) return;

  const audioTrack = localStream.getAudioTracks()[0];
  isMuted = !isMuted;
  audioTrack.enabled = !isMuted;
  muteBtn.textContent = isMuted ? "üîá" : "üéôÔ∏è";
};

/* =========================
   END CALL
========================= */
endBtn.onclick = () => {
  if (currentCall) currentCall.close();
  if (localStream) localStream.getTracks().forEach(t => t.stop());
  remoteVideo.srcObject = null;
  localVideo.srcObject = null;
  connectBox.classList.remove('hidden');
};
</script>

</body>
</html>
